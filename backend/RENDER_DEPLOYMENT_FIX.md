# Render Deployment Fix Guide

## üîß Issue Fixed: `nodemon: not found` Error

The error occurs because Render was trying to run development commands in production. Here's what was fixed:

## ‚úÖ Changes Made

### 1. **Fixed package.json Dependencies**

- Moved all `@types/*` and build dependencies to `dependencies` (needed for TypeScript compilation)
- Moved `ts-node` and `typescript` to `dependencies` (required for build process)
- Kept only `nodemon` in `devDependencies` (development only)

### 2. **Updated render.yaml Configuration**

```yaml
buildCommand: npm install && npm run build # Changed from yarn to npm
startCommand: npm start # Ensures production start
```

### 3. **Enhanced Scripts**

- Added `prestart` script to ensure build runs before start
- Changed `postinstall` to use `npm` instead of `yarn`
- Ensured consistent use of npm throughout

### 4. **Added Email Environment Variables**

- `EMAIL_USER` - Gmail address for sending invites
- `EMAIL_PASS` - Gmail app password

## üöÄ Deployment Instructions

### Step 1: Push Changes

```bash
git add .
git commit -m "Fix Render deployment: nodemon not found error"
git push origin main
```

### Step 2: Render Configuration

1. Go to your Render dashboard
2. Select your backend service
3. Go to **Settings** ‚Üí **Build & Deploy**
4. Ensure these settings:
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm start`
   - **Root Directory**: `backend`

### Step 3: Environment Variables

Set these in Render dashboard **Environment** tab:

```
NODE_ENV=production
MONGODB_URI=mongodb+srv://osohbayar:U4c8befcf18ca@mentormeet.xfipt6t.mongodb.net/e-sport-connection
JWT_SECRET=<auto-generated>
SESSION_SECRET=<auto-generated>
FRONTEND_URL=https://e-sport-connection.vercel.app
EMAIL_USER=your-gmail@gmail.com
EMAIL_PASS=your-gmail-app-password
```

### Step 4: Manual Deploy

1. Go to **Deploys** tab
2. Click **Deploy latest commit**
3. Monitor the build logs

## üîç Build Process Check

The build should follow this sequence:

1. ‚úÖ `npm install` - Install dependencies
2. ‚úÖ `npm run build` - Compile TypeScript to JavaScript
3. ‚úÖ `npm start` - Run compiled JavaScript from `dist/index.js`

## üö® Troubleshooting

### If you still see nodemon errors:

1. **Clear Render cache**: In Settings ‚Üí Build & Deploy ‚Üí Clear cache
2. **Check logs**: Look for any references to development commands
3. **Verify scripts**: Ensure no script is calling `nodemon` directly

### If TypeScript compilation fails:

1. **Check dependencies**: All `@types/*` packages should be in `dependencies`
2. **Verify tsconfig.json**: Should output to `./dist` directory
3. **Check source files**: Look for any TypeScript errors

### If app doesn't start:

1. **Check NODE_ENV**: Should be `production`
2. **Verify MongoDB**: Connection string should be correct
3. **Check port**: App should use `process.env.PORT || 8000`

## ‚úÖ Success Indicators

When deployment is successful, you should see:

```
‚úÖ Build completed successfully
‚úÖ MongoDB connected successfully
‚úÖ Server running on port XXXX
‚úÖ Health check: /health endpoint responds
```

## üìß Email Service Setup

After deployment, set up Gmail for email invites:

1. Enable 2-Factor Authentication on Gmail
2. Generate an App Password
3. Set `EMAIL_USER` and `EMAIL_PASS` in Render environment variables

## üîó Useful Links

- **Backend Health Check**: `https://your-app.onrender.com/health`
- **API Test**: `https://your-app.onrender.com/api/test-cors`
- **Render Logs**: Available in dashboard
- **MongoDB Atlas**: [https://cloud.mongodb.com](https://cloud.mongodb.com)
